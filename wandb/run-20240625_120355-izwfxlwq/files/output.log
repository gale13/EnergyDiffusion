


Epoch #1: 1000it [00:33, 30.10it/s, env_step=1000, len=24, loss/critic=5256.838, n/ep=40, n/st=1000, overall_loss=0.005, rew=-1745.22]
Epoch #2:   0%|                                                                                                                 | 0/100 [00:00<?, ?it/s]


Epoch #2: 1000it [00:26, 107.27it/s]
Epoch #2: 1000it [00:31, 31.78it/s, env_step=2000, len=24, loss/critic=14713.153, n/ep=40, n/st=1000, overall_loss=0.004, rew=-1149.50]


Epoch #3: 1000it [00:24, 102.91it/s]
Epoch #3: 1000it [00:29, 33.78it/s, env_step=3000, len=24, loss/critic=23316.272, n/ep=40, n/st=1000, overall_loss=0.004, rew=-996.31]


Epoch #4: 1000it [00:24, 117.90it/s]
Epoch #4: 1000it [00:27, 35.95it/s, env_step=4000, len=24, loss/critic=29879.273, n/ep=40, n/st=1000, overall_loss=0.004, rew=-880.87]


Epoch #5: 1000it [00:26, 116.82it/s]
Epoch #5: 1000it [00:27, 36.40it/s, env_step=5000, len=24, loss/critic=35435.934, n/ep=40, n/st=1000, overall_loss=0.003, rew=-782.51]


Epoch #6: 1000it [00:18, 120.74it/s]
Epoch #6: 1000it [00:27, 35.88it/s, env_step=6000, len=24, loss/critic=40865.729, n/ep=50, n/st=1000, overall_loss=0.003, rew=-745.84]


Epoch #7: 1000it [00:20, 121.90it/s]
Epoch #7: 1000it [00:27, 35.89it/s, env_step=7000, len=24, loss/critic=44839.701, n/ep=40, n/st=1000, overall_loss=0.002, rew=-756.29]


Epoch #8: 1000it [00:22, 118.38it/s]
Epoch #8: 1000it [00:27, 36.08it/s, env_step=8000, len=24, loss/critic=47356.647, n/ep=40, n/st=1000, overall_loss=0.003, rew=-696.28]


Epoch #9: 1000it [00:24, 121.55it/s]
Epoch #9: 1000it [00:26, 37.05it/s, env_step=9000, len=24, loss/critic=50856.574, n/ep=40, n/st=1000, overall_loss=0.002, rew=-591.38]


Epoch #10: 1000it [00:27, 121.67it/s]
Epoch #10: 1000it [00:27, 36.09it/s, env_step=10000, len=24, loss/critic=55661.915, n/ep=40, n/st=1000, overall_loss=0.003, rew=-601.29]



Epoch #11: 1000it [00:27, 36.57it/s, env_step=11000, len=24, loss/critic=57547.258, n/ep=40, n/st=1000, overall_loss=0.002, rew=-693.36]
Epoch #11: test_reward: -590.710509 ± 0.000000, best_reward: -374.424056 ± 0.000000 in #8


Epoch #12: 1000it [00:27, 36.50it/s, env_step=12000, len=24, loss/critic=63028.406, n/ep=50, n/st=1000, overall_loss=0.003, rew=-584.89]
Epoch #13:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #13: 1000it [00:27, 35.91it/s, env_step=13000, len=24, loss/critic=65939.552, n/ep=40, n/st=1000, overall_loss=0.002, rew=-637.71]
Epoch #14:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]



Epoch #14: 1000it [00:28, 35.44it/s, env_step=14000, len=24, loss/critic=69333.362, n/ep=40, n/st=1000, overall_loss=0.003, rew=-604.82]
Epoch #14: test_reward: -451.812305 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13

Epoch #15: 1000it [00:28, 35.55it/s, env_step=15000, len=24, loss/critic=74449.659, n/ep=40, n/st=1000, overall_loss=0.002, rew=-574.88]
Epoch #15: test_reward: -968.923531 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13


Epoch #16: 1000it [00:18, 121.47it/s]
Epoch #16: 1000it [00:27, 35.83it/s, env_step=16000, len=24, loss/critic=79123.009, n/ep=40, n/st=1000, overall_loss=0.003, rew=-577.47]



Epoch #17: 1000it [00:27, 36.71it/s, env_step=17000, len=24, loss/critic=79310.244, n/ep=40, n/st=1000, overall_loss=0.002, rew=-616.24]
Epoch #17: test_reward: -419.924029 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13


Epoch #18: 1000it [00:27, 36.47it/s, env_step=18000, len=24, loss/critic=86993.698, n/ep=50, n/st=1000, overall_loss=0.003, rew=-599.90]
Epoch #19:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #19: 1000it [00:25, 121.53it/s]
Epoch #19: 1000it [00:26, 37.29it/s, env_step=19000, len=24, loss/critic=89380.730, n/ep=40, n/st=1000, overall_loss=0.002, rew=-574.47]

Epoch #20: 1000it [00:27, 35.91it/s, env_step=20000, len=24, loss/critic=94455.834, n/ep=40, n/st=1000, overall_loss=0.003, rew=-604.19]
Epoch #21:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #21: 1000it [00:27, 35.87it/s, env_step=21000, len=24, loss/critic=97712.688, n/ep=40, n/st=1000, overall_loss=0.002, rew=-575.73]
Epoch #22:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #22: 1000it [00:27, 36.14it/s, env_step=22000, len=24, loss/critic=100254.519, n/ep=40, n/st=1000, overall_loss=0.003, rew=-567.01]
Epoch #23:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]

Epoch #23: 1000it [00:24, 41.59it/s, env_step=23000, len=24, loss/critic=104518.153, n/ep=40, n/st=1000, overall_loss=0.002, rew=-583.85]
Epoch #24:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #24: 1000it [00:24, 41.64it/s, env_step=24000, len=24, loss/critic=114624.730, n/ep=50, n/st=1000, overall_loss=0.003, rew=-590.69]
Epoch #25:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #25: 1000it [00:26, 38.22it/s, env_step=25000, len=24, loss/critic=115541.083, n/ep=40, n/st=1000, overall_loss=0.002, rew=-565.10]
Epoch #25: test_reward: -695.265614 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13


Epoch #26: 1000it [00:26, 37.04it/s, env_step=26000, len=24, loss/critic=121439.072, n/ep=40, n/st=1000, overall_loss=0.003, rew=-494.24]
Epoch #27:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]



Epoch #27: 1000it [00:26, 37.57it/s, env_step=27000, len=24, loss/critic=122275.918, n/ep=40, n/st=1000, overall_loss=0.002, rew=-584.45]
Epoch #27: test_reward: -762.994144 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13



Epoch #28: 1000it [00:27, 35.94it/s, env_step=28000, len=24, loss/critic=128635.487, n/ep=40, n/st=1000, overall_loss=0.003, rew=-557.15]
Epoch #28: test_reward: -399.586059 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13

Epoch #29: 1000it [00:27, 36.92it/s, env_step=29000, len=24, loss/critic=130410.431, n/ep=40, n/st=1000, overall_loss=0.002, rew=-583.02]
Epoch #30:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #30: 1000it [00:27, 36.78it/s, env_step=30000, len=24, loss/critic=140016.112, n/ep=50, n/st=1000, overall_loss=0.003, rew=-498.24]
Epoch #31:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #31: 1000it [00:21, 122.04it/s]
Epoch #31: 1000it [00:27, 36.60it/s, env_step=31000, len=24, loss/critic=137838.192, n/ep=40, n/st=1000, overall_loss=0.002, rew=-565.09]


Epoch #32: 1000it [00:26, 37.80it/s, env_step=32000, len=24, loss/critic=144546.547, n/ep=40, n/st=1000, overall_loss=0.003, rew=-522.98]
Epoch #33:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]

Epoch #33: 1000it [00:27, 36.72it/s, env_step=33000, len=24, loss/critic=144648.683, n/ep=40, n/st=1000, overall_loss=0.002, rew=-561.22]
Epoch #34:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]



Epoch #34: 1000it [00:27, 36.94it/s, env_step=34000, len=24, loss/critic=150056.170, n/ep=40, n/st=1000, overall_loss=0.003, rew=-530.75]
Epoch #34: test_reward: -567.362752 ± 0.000000, best_reward: -365.827596 ± 0.000000 in #13


Epoch #35: 1000it [00:27, 36.91it/s, env_step=35000, len=24, loss/critic=150073.585, n/ep=40, n/st=1000, overall_loss=0.002, rew=-560.79]
Epoch #36:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #36: 1000it [00:27, 36.60it/s, env_step=36000, len=24, loss/critic=159064.462, n/ep=50, n/st=1000, overall_loss=0.003, rew=-549.41]
Epoch #37:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #37: 1000it [00:27, 36.40it/s, env_step=37000, len=24, loss/critic=159409.237, n/ep=40, n/st=1000, overall_loss=0.002, rew=-514.03]
Epoch #38:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #38: 1000it [00:27, 37.03it/s, env_step=38000, len=24, loss/critic=161987.448, n/ep=40, n/st=1000, overall_loss=0.003, rew=-492.85]
Epoch #39:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #39: 1000it [00:24, 40.24it/s, env_step=39000, len=24, loss/critic=156851.415, n/ep=40, n/st=1000, overall_loss=0.002, rew=-529.66]
Epoch #40:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]

Epoch #40: 1000it [00:23, 41.76it/s, env_step=40000, len=24, loss/critic=165655.566, n/ep=40, n/st=1000, overall_loss=0.003, rew=-540.98]
Epoch #41:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #41: 1000it [00:24, 40.38it/s, env_step=41000, len=24, loss/critic=163508.553, n/ep=40, n/st=1000, overall_loss=0.002, rew=-517.74]
Epoch #42:   0%|                                                                                                                | 0/100 [00:00<?, ?it/s]


Epoch #42: 1000it [00:23, 41.76it/s, env_step=42000, len=24, loss/critic=170219.494, n/ep=50, n/st=1000, overall_loss=0.003, rew=-485.18]
Epoch #42: test_reward: -476.307948 ± 0.000000, best_reward: -360.701360 ± 0.000000 in #37

Epoch #43: 1000it [00:19, 52.55it/s]
Traceback (most recent call last):
  File "main.py", line 109, in <module>
    result = offpolicy_trainer(
  File "/opt/conda/envs/gdmopt/lib/python3.8/site-packages/tianshou/trainer/offpolicy.py", line 133, in offpolicy_trainer
    return OffpolicyTrainer(*args, **kwargs).run()
  File "/opt/conda/envs/gdmopt/lib/python3.8/site-packages/tianshou/trainer/base.py", line 441, in run
    deque(self, maxlen=0)  # feed the entire iterator into a zero-length deque
  File "/opt/conda/envs/gdmopt/lib/python3.8/site-packages/tianshou/trainer/base.py", line 299, in __next__
    self.policy_update_fn(data, result)
  File "/opt/conda/envs/gdmopt/lib/python3.8/site-packages/tianshou/trainer/offpolicy.py", line 122, in policy_update_fn
    losses = self.policy.update(self.batch_size, self.train_collector.buffer)
  File "/lxy/energydiffusion/policy/diffusion_opt.py", line 105, in update
    batch = self.process_fn(batch, buffer, indices)
  File "/lxy/energydiffusion/policy/diffusion_opt.py", line 81, in process_fn
    return self.compute_nstep_return(
  File "/opt/conda/envs/gdmopt/lib/python3.8/site-packages/tianshou/policy/base.py", line 391, in compute_nstep_return
    target_q_torch = target_q_fn(buffer, terminal)  # (bsz, ?)
  File "/lxy/energydiffusion/policy/diffusion_opt.py", line 76, in _target_q
    target_q = self._target_critic.q_min(batch.obs_next, ttt)
  File "/lxy/energydiffusion/diffusion/model.py", line 88, in q_min
    return torch.min(*self.forward(obs, action))
KeyboardInterrupt